dnl ICS autoconf input

dnl begin
AC_INIT(src/ics.mli)

AC_PREFIX_DEFAULT(/usr)

dnl optionally give path, otherwise use cwd
AC_MSG_CHECKING(icspath)
AC_ARG_WITH(icspath, [ --with-icspath=/path/to/ics ])
if test "x$with_icspath" = "x"; then
  ICSPATH=`pwd`
else
  ICSPATH=$with_icspath
fi
if ! test -f $ICSPATH/ics.in; then
  AC_MSG_ERROR(Invalid ICS path)
fi
AC_MSG_RESULT($ICSPATH)
AC_SUBST(ICSPATH)

dnl Check for programs

dnl Check for OCaml programs
AC_CHECK_PROG(OCAMLC,ocamlc,ocamlc,no)
if test "$OCAMLC" = no ; then
	AC_MSG_ERROR(Cannot find ocamlc.)
fi
AC_CHECK_PROG(OCAMLOPT,ocamlopt,ocamlopt,no)
if test "$OCAMLOPT" = no ; then
	AC_MSG_ERROR(Cannot find ocamlopt.)
fi
AC_CHECK_PROG(OCAMLMKTOP,ocamlmktop,ocamlmktop,no)
if test "$OCAMLMKTOP" = no ; then
	AC_MSG_ERROR(Cannot find ocamlmktop.)
fi
AC_CHECK_PROG(OCAMLDEP,ocamldep,ocamldep,no)
if test "$OCAMLDEP" = no ; then
	AC_MSG_ERROR(Cannot find ocamldep.)
fi
AC_CHECK_PROG(OCAMLLEX,ocamllex,ocamllex,no)
if test "$OCAMLLEX" = no ; then
	AC_MSG_ERROR(Cannot find ocamllex.)
fi
AC_CHECK_PROG(OCAMLYACC,ocamlyacc,ocamlyacc,no)
if test "$OCAMLYACC" = no ; then
	AC_MSG_ERROR(Cannot find ocamlyacc.)
fi

dnl Check for other programs
AC_CHECK_PROG(HEVEA,hevea,hevea,true)
if test "$HEVEA" = true ; then
	AC_MSG_WARN(Cannot find hevea -- but not mandatory)
fi

AC_CHECK_PROG(OCAMLWEB,ocamlweb,ocamlweb,true)
if test "$OCAMLWEB" = true ; then
	AC_MSG_WARN(Cannot find ocamlweb -- but not mandatory)
fi

dnl Check for library
AC_CHECK_LIB(gmp,mpz_cmp, , AC_MSG_WARN(Cannot find the GMP library - please set manually in the Makefile.))

AC_CHECK_PROG(ALLEGRO,allegro6.0,allegro6.0,no)
if test "$ALLEGRO" = no ; then
        AC_MSG_ERROR(Cannot find allegro6.0)
fi

dnl Finally create all the generated files
AC_OUTPUT(Makefile chameleon/Makefile ics)

chmod a+x ics
